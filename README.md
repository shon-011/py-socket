# socket

# HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã£ã¦ã¿ã‚‹

# å°å…¥

### æœ€è¿‘ã®è©±

- æ–°å’ç ”ä¿®ã®ãŸã‚WEBã®åŸºç¤çš„ãªæœ¬ã‚’èª­ã‚€
- Djangoå­¦ç¿’

åŸºç¤æŠ€è¡“ã‚’ã©ã®ã‚ˆã†ã®ã«ã—ã¦ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã‚Šã‚ˆã†ã—ã¦ã„ã‚‹ã®ã‹ã€ãƒ¯ã‚«ãƒ©ãƒŠã‚¤...ğŸ˜¢

---

- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã‚ã‚ŠãŒãŸã¿ã‚’æ„Ÿã˜ã‚‹
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãªã„ã¨ãªã‹ãªã‹å­¦ç¿’ã™ã‚‹æ©Ÿä¼šãŒãªã„ã®ã§ã¯ï¼Ÿ

â†’ **ä½œã£ã¦ã¿ã‚‹!**

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åŸºç¤

ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã™ã¹ã¦ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã¯ä»Šå›æ§ãˆã¦ãŠãã¾ã™ã€‚

ã¾ãšã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã®é€šä¿¡ã«è§¦ã‚Œã‚‹ãŸã‚HTTPã‚µãƒ¼ãƒãƒ¼ã‚‰ã—ãã‚‚ã®ã‚’ä½œã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŒã„ã¦ã„ãã¨ã„ã†ã“ã¨ã‚’ã‚„ã£ã¦ã„ãã¾ã™ã€‚

# socket ã‚½ã‚±ãƒƒãƒˆé€šä¿¡

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åŸºç¤æŠ€è¡“

> ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¯TCP/IPã¨å‘¼ã¶é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’åˆ©ç”¨ã—ã¾ã™ãŒã€ãã®TCP/IPã‚’ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸–ç•Œã¨TCP/IPã®ä¸–ç•Œã‚’çµã¶ç‰¹åˆ¥ãª å‡ºå…¥ã‚Šå£ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚ãã®**å‡ºå…¥ã‚Šå£ã¨ãªã‚‹ã®ãŒã‚½ã‚±ãƒƒãƒˆ (Socket)**ã§ã‚ã‚Šã€TCP/IPã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ä¸Šã®å¤§ããªç‰¹å¾´ã¨ãªã£ã¦ã„ã¾ã™ã€‚ ã“ã®ãŸã‚ã€TCP/IPé€šä¿¡ã‚’ã‚½ã‚±ãƒƒãƒˆé€šä¿¡ã¨å‘¼ã¶ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
å¼•ç”¨å…ƒï¼šhttp://research.nii.ac.jp/~ichiro/syspro98/socket.html
> 

â†’ ã“ã‚Œã¯æ¦‚å¿µçš„ãªã‚‚ã®ã§ã€å®Ÿéš›ã«ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒåˆ©ç”¨ã™ã‚‹æ¨™æº–å…¥å‡ºåŠ›ã‚„ãƒ•ã‚¡ã‚¤ãƒ«å…¥å‡ºåŠ›ã‚’OSãŒè­˜åˆ¥ã™ã‚‹ãŸã‚ã®**è­˜åˆ¥å­**ã‚‰ã—ã„

## Socketã®ãƒ•ãƒ­ãƒ¼

![d9bbd3786f65025dbaf748de7c0cd34d-1.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ed9dc55c-d79f-4e2e-8471-1b123821cbd1/d9bbd3786f65025dbaf748de7c0cd34d-1.png)

## é€šä¿¡ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

é€šä¿¡ã«ã¯ã„ãã¤ã‚‚ã®æ–¹å¼ãŒã‚ã‚Šã€æ–¹å¼ã‚’æ±ºã‚ã‚‹ãŸã‚ã®ä¸»ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯

- ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ã‚¡ãƒŸãƒªãƒ¼
- ã‚½ã‚±ãƒƒãƒˆã‚¿ã‚¤ãƒ—

## ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ã‚¡ãƒŸãƒªãƒ¼

ã‚½ã‚±ãƒƒãƒˆã«ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¨®é¡

- AF_UNIC ãƒ­ãƒ¼ã‚«ãƒ«é€šä¿¡
- AF_INET  IPv4
- AF_INET6 IPv6

ä»–ã«ã‚‚ã„ã‚ã„ã‚ã‚ã‚‹

[https://man7.org/linux/man-pages/man2/socket.2.html](https://man7.org/linux/man-pages/man2/socket.2.html)

## ã‚½ã‚±ãƒƒãƒˆã‚¿ã‚¤ãƒ—

- SOCK_STREAM  åŒæ–¹å‘ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ TCP
- SOCK_DGRAM  ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ã‚¹ã€€UDP

ã“ã¡ã‚‰ã‚‚è‰²ã€…ã‚ã‚‹ã¿ãŸã„ã€‚

## Python socketãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

Pythonã«ã¯æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦socketãŒå«ã¾ã‚Œã¦ã„ã¦ç°¡å˜ã«å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## socketã¨ã„ãˆã°TCP/IPã‚‰ã—ã„ã§ã™

> INET (ã™ãªã‚ã¡ IPv4) ã‚½ã‚±ãƒƒãƒˆã®ã“ã¨ã—ã‹èªã‚‰ãªã„ã¤ã‚‚ã‚Šã ãŒã€åˆ©ç”¨ç‡ã§ã„ã†ã¨ã‚½ã‚±ãƒƒãƒˆã® 99% ä»¥ä¸Šã¯ã“ã‚Œã ã€‚ã•ã‚‰ã«ä¸­ã§ã‚‚ STREAM (ã™ãªã‚ã¡ TCP) ã‚½ã‚±ãƒƒãƒˆã«è©±é¡Œã‚’çµã‚ã†ã¨æ€ã† - è‡ªåˆ†ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã£ã¦ã„ã‚‹ã®ã§ãªã„é™ã‚Š (åˆ†ã‹ã£ã¦ã‚‹ãªã‚‰ã“ã® HOWTO ãªã‚“ã¦è¦ã‚‰ãªã„ã ã‚!)ã€STREAM ã‚½ã‚±ãƒƒãƒˆãŒä¸€ç•ªåˆ†ã‹ã‚Šã‚„ã™ãã€ä¸€ç•ªæ€§èƒ½ãŒå‡ºã‚‹ã®ã ã€‚
å¼•ç”¨å…ƒï¼šhttps://docs.python.org/ja/3/howto/sockets.html
> 

# ã‚„ã£ã¦ã¿ã‚‹

## Step1:ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™

```python
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(("127.0.01",1235))
s.listen()

while True:
    clientsocket, address = s.accept()
    clientsocket.send(bytes("Welcome to the server!", 'utf-8'))
    clientsocket.close()

```

## Step2:HTTP/GET

HTTPãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®Ÿè£…ã—GETã‚’è¡Œã„ã¾ã™

`/test`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Helloã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæˆ»ã‚Šã€ãã‚Œä»¥å¤–ã ã¨404ã‚’è¿”ã™å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

## Step3: é–¢æ•°åŒ–ã—ã¦æ•´ç†

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†ã‚’é–¢æ•°åŒ–ã—ã¦æ•´ç†ã—ã¾ã—ãŸã€‚

## Step4: curl

HTTPã¯å˜ãªã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®äº¤æ›ã«ã™ããªã„ï¼

# æœ€å¾Œã«...

ä»Šå›ã“ã‚Œã‚’ã‚„ã£ã¦ã¿ã‚‹ã¾ã§ã€æ¥ãšã‹ã—ãªãŒã‚‰socketã®ã“ã¨ã‚’çŸ¥ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
åŸºç¤çš„ãªæŠ€è¡“ã‚’çŸ¥ã‚‰ãšã—ã¦ä½œã‚‹ã“ã¨ã¯ã§ãã‚‹ã¨æ€ã„ã¾ã™ãŒã€çŸ¥ã£ã¦ãŠã„ã¦æã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚
å°‘ã—ãšã¤webã®åŸºç¤æŠ€è¡“ã‚’ç†è§£ã§ããŸã‚‰ã¨æ€ã„ã¾ã™ã€‚

## ç´¢å¼•

- Real World HTTP: [https://www.oreilly.co.jp/books/9784873119038/](https://www.oreilly.co.jp/books/9784873119038/)
- [https://dev.classmethod.jp/articles/python3socketserver/](https://dev.classmethod.jp/articles/python3socketserver/)
- [https://logmi.jp/tech/articles/314757](https://logmi.jp/tech/articles/314757)
- [https://qiita.com/megadreams14/items/32a3eed4661e55419e1c](https://qiita.com/megadreams14/items/32a3eed4661e55419e1c)